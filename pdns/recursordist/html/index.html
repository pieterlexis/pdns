<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<script src="js/jquery-1.8.3.min.js"></script>
<script src="js/d3.v3.js"></script>
<script src="js/rickshaw.min.js"></script>
<script src="js/handlebars-v4.0.11.js"></script>
<script src="js/moment.min.js"></script>
<link type="text/css" rel="stylesheet" href="graph.css">
<link type="text/css" rel="stylesheet" href="detail.css">
<link type="text/css" rel="stylesheet" href="legend.css">
<link type="text/css" rel="stylesheet" href="lines.css">

<script src="local.js"></script>

<style>
	.pdns-chart {
		position: relative;
		left: 40px;
		z-index: -10; /* don't steal clicks from stuff it overlaps with */
	}
	.pdns-axis {
		position: absolute;
		top: 0;
		bottom: 0;
		width: 40px;
	}
	#connection-status, #connection-error {
		color: red;
	}
	.topbar {
		background: url(powerdns-logo-220px.png) no-repeat;
		height: 30px;
		padding-left: 250px;
		padding-top: 5px;
	}
	.charts-container {
		display: inline-block;
		width: 500px;
		vertical-align: top;
	}
	.charts-container .chart {
	}
	.charts-container h2 {
		padding-left: 40px;
		text-align: center;
	}
	.all-tables {
		display: inline-block;
		min-width: 700px;
		vertical-align: top;
	}
	.table-container {
		display: inline-block;
		width: 330px;
		vertical-align: top;
		margin-right: 20px;
	}
	h2 {
		font-size: 16pt;
	}
	.stats-table {
	}
	.stats-table table,
	.stats-table th,
	.stats-table td {
		/*border: 1px solid #aaaaaa;*/
		border-left: 1px solid #aaaaaa;
		border-right: 1px solid #aaaaaa;
		border-collapse: collapse;
		text-overflow: ellipsis;
	}
	.stats-table td,
	.stats-table th {
		padding-left: 4px;
		padding-right: 4px;
	}
	.stats-table th {
		text-align: left;
		border: 1px solid #aaaaaa;
	}
	.stats-table table {
		width: 100%;
		margin-top: 30px;
		border: 1px solid #aaaaaa;
	}
	.stats-table table tr:last-child {
		border: 1px solid #aaaaaa;
	}
	table.two-col th:first-child { width: 25%; }
	table.three-col th:first-child { width: 25%; }
	table.three-col th:last-child { width: 20%; }
	.stats-table td:empty:after{
  		content: "\00a0"; /* non-breaking space */
	}
</style>

</head>

<body>

<!-- ========================= CONTENT ========================= -->

<div class="topbar">
	<label>API Key: <input type="password" id="password" value="x"></label>
	<span id="connection-status" style="display:none">No server connection or incorrect key</span>
	<span id="connection-error"></span>
</div>

<div id="top-stats"></div>

<div class="charts-container">
	<div class="qps-chart-container chart">
		<h2>QPS / SERVFAILPS</h2>
		<div class="chart_container">
			<div id="qpsy_axis" class="pdns-axis"></div>
			<div id="qpschart" class="pdns-chart"></div>
		</div>
	</div>
	<div class="qps-chart-container chart">
		<h2>CPU</h2>
		<div class="chart_container">
			<div id="cpuy_axis" class="pdns-axis"></div>
			<div id="cpuchart" class="pdns-chart"></div>
		</div>
	</div>
</div>

<div class="all-tables">
    <div class="table-container">
        <h2>Queries</h2>
        <label><input id="filter1" type="checkbox"> Group by public suffixes</label>
        <div class="stats-table" id="queryring"></div>
        <div class="stats-table" id="servfailqueryring"></div>
    </div>

    <div class="table-container">
        <h2>Remotes</h2>
        <label><input id="filter2" type="checkbox"> Group by public suffixes</label>
        <div class="stats-table" id="remotering"></div>
        <div class="stats-table" id="servfailremotering"></div>
    </div>
</div>

<!-- ========================= TEMPLATES ========================= -->
<script id="top-stats-template" type="text/x-handlebars-template">
	<p>
		Version: {{version}}, uptime: {{uptime}}, Number of queries: {{questions}} ({{qps}} qps)<br/>
		Over-capacity-drops: {{over_capacity_drops}}, too old: {{too_old}}<br/>
		Packet cache hitrate: {{phitrate}}%,
		Average response time: {{latency}} ms, CPU Usage: {{cpu}}% <br/>
	</p>
</script>

<script id="queryring-template" type="text/x-handlebars-template">
	<table class="three-col">
		<tr><th>Number</th><th>Domain</th><th>Type</th></tr>
		{{#each rows}}
		<tr>
			<td>{{0}}</td>
			<td>{{1}}</td>
			<td>{{2}}</td>
		</tr>
		{{/each}}
	</table>
</script>

<script id="servfailqueryring-template" type="text/x-handlebars-template">
	<table class="three-col">
		<tr><th>Number</th><th>Servfail domain</th><th>Type</th></tr>
		{{#each rows}}
		<tr>
			<td>{{0}}</td>
			<td>{{1}}</td>
			<td>{{2}}</td>
		</tr>
		{{/each}}
	</table>
</script>

<script id="remotering-template" type="text/x-handlebars-template">
	<table class="two-col">
		<tr><th>Number</th><th>Remote</th></tr>
		{{#each rows}}
		<tr>
			<td>{{0}}</td>
			<td>{{1}}</td>
		</tr>
		{{/each}}
	</table>
</script>

<script id="servfailremotering-template" type="text/x-handlebars-template">
	<table class="two-col">
		<tr><th>Number</th><th>Servfail remote</th></tr>
		{{#each rows}}
		<tr>
			<td>{{0}}</td>
			<td>{{1}}</td>
		</tr>
		{{/each}}
	</table>
</script>

</body>
</html>
